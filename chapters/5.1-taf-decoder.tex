\chapter{Decodificação do TAF}

O TAF (Terminal Aerodrome Forecast) é uma informação meteorológica que fornece
previsões para aeroportos, sendo uma ferramenta crucial para a aviação. Diferente
do METAR, que relata as condições meteorológicas atuais, o TAF projeta o que se
espera para as próximas horas e/ou dias. Ele é composto por diversas seções,
cada uma contendo informações específicas sobre as condições previstas para o
período. Uma diferença em relação ao METAR é que o TAF se entende por várias linhas.
A partir da segunda linha temos os grupos temporais. Tudo que está em uma linha
são condições que irão ocorrer dentro de uma faixa de tempo. 

Neste capítulo, será apresentado um exemplo de TAF, sua decodificação,
e uma explicação do algoritmo utilizado.

\section{Exemplo}
O TAF emitido para o aeroporto de Pinto Martins (SBFZ) no dia 31 de agosto 
de 2024 às 09:00Z foi:

\begin{verbatim}
310900Z 3112/0112 15010KT CAVOK TX31/3115Z TN24/0108Z 
  BECMG 3115/3117 11015KT FEW025 
  BECMG 0104/0106 15010KT RMK PHD
\end{verbatim}

Vamos decodificar este TAF passo a passo:
310900Z significa que este TAF foi gerado dia 31 às 09:00 ou seis da manhã em 
horário local. 3112/0112 diz o período válido desta informação: do dia 31 às 
12 horas até dia primeiro às 12 horas. 15010KT indica um vento de 10 nós vindo 
da direção 150 graus. Não há nuvens e a visualidade é máxima é usado o acrônimo 
CAVOK (Ceiling Altitude and Visibility OK) para indicar isto.

A temperatura mínima será de 24 graus dia 01 às 08:00 (UTC) e a máxima será 
de 31 graus no dia 31 as 15:00 (UTC).

A seguir vem os grupos de previsão, cada um em uma linha.

BECMG 3115/3117 11015KT FEW025: Dia 31 das 15 às 17 horas UTC terá vento de 
15 nós com 110 graus. E haverá poucas nuvens na altitude no nível 025 ou 2500 pés.

BECMG 0104/0106 15010KT RMK PHD : dia primeiro de setembro das 04:00 as 06:00, 
o vento será de 10 nós com 150 graus.

RMK adiciona uma observação (remark). O trigrama PHD representa a identificação 
do previsor que
gerou este TAF. É algo específico do Brasil [16].

É claro que há muitos outros itens possíveis dentro da especificação. PROB30 em 
um grupo de previsão, por exemplo, informa que as informações nesta linha tem 
30\% de chance de ocorrerem.

O objetivo do meu decodificador é explicar corretamente qualquer TAF brasileiro.


\section{Algoritmo}

O algoritmo para lidar com um TAF é semelhante ao utilizado para o METAR, porém adaptado
para as especificidades das previsões temporais. O TAF é segmentado em diversas
partes, cada uma sendo processada individualmente por expressões regulares para extrair as
informações relevantes.

Para cada item do TAF, o algoritmo tenta associar a string correspondente a uma descrição
detalhada utilizando expressões regulares pré-definidas. Por exemplo, a expressão

\begin{verbatim}
[0-9]{4}/[0-9]{4} 
\end{verbatim}

é usada para identificar os períodos de tempo, enquanto a expressão

\begin{verbatim}
[0-9]{3}([0-9]{2})KT
\end{verbatim}

é utilizada para extrair a direção e velocidade do vento.

Assim como no METAR, as informações são organizadas em tuplas que contêm a string original
e sua decodificação correspondente. Essas tuplas são então enviadas para um sistema de
templating Jinja2, para a geração da página HTML.

\section{Exemplo de Resposta}

\begin{verbatim}
[
    ["251600Z",
    "Disponibilizado em 16:00Z no dia 25"],
    ["2518/2624",
    "Válido do dia 25 as 18:00Z até dia 26 as 24:00Z"],
    ["23012KT",
    "Vento proa <b>230</b>° com velocidade <b>12</b> nós (kt)."],
    ["8000",
    "Visibilidade 8000 metros"],
    ["BKN020",
    "Nuvens broken (5/8 a 7/8 do céu com nuvens) em <b>2000</b> 
    pés de altitude. "],
    ["BKN030",
    "Nuvens broken (5/8 a 7/8 do céu com nuvens) em <b>3000</b> 
    pés de altitude. "],
    ["TN16/2609Z",
    "A temperatura mínima é de 16°C prevista de ocorrer dia 26 
    as 09:00 (UTC)"],
    ["TX20/2615Z",
    "A temperatura máxima é de 20°C prevista de ocorrer dia 26 
    as 15:00 (UTC)"],
    [
        ["TEMPO 2518/2521",
        "Condições temporárias previstas do dia 25 as 18:00 (UTC) 
        até dia 25 as 
        21:00 (UTC)"],
        ["23012G25KT",
        "Vento proa 230° com velocidade 12 nós (kt) e <b>rajadas
        </b> de 25 nós."],
        ["5000",
        "Visibilidade 5000 metros"],
        ["DZ",
        "Chuvisco moderada."],
        ["BR",
        "Névoa úmida moderada."],
        ["BKN015",
        "Nuvens broken (5/8 a 7/8 do céu com nuvens) em <b>1500</b> 
        pés de altitude. "],
        ["BKN020",
        "Nuvens broken (5/8 a 7/8 do céu com nuvens) em <b>2000</b> 
        pés de altitude. "]
    ],
    [
        ["TEMPO 2521/2524",
        "Condições temporárias previstas do dia 25 as 21:00 (UTC) 
        até dia 25 as 24:00 
        (UTC)"],
        ["25010KT",
        "Vento proa <b>250</b>° com velocidade <b>10</b> nós (kt)."],
        ["4000",
        "Visibilidade 4000 metros"],
        ["RA",
        "Chuva moderada."],
        ["BR",
        "Névoa úmida moderada."],
        ["BKN010",
        "Nuvens broken (5/8 a 7/8 do céu com nuvens) em <b>1000</b> 
        pés de altitude. "],
        ["BKN020",
        "Nuvens broken (5/8 a 7/8 do céu com nuvens) em <b>2000</b> 
        pés de altitude. "]
    ]
]
\end{verbatim}
